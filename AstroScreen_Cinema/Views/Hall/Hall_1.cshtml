@namespace AstroScreen_Cinema.Views.NowShowing
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers

@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewData["Title"] = "Hall";
}

<link rel="stylesheet" href="~/css/Hall/Hall1.css" />
<link rel="stylesheet" href="~/css/Home/site.css" />



<div class="SeatSelector">
    <div class="SelectorTitle"> </div>
        <h1>Hall #1</h1>
    
    <!--Hall legend-->
    <div class="hall-legend">
        <div class="seat-legend">Not Selected - 5$</div>
        <div class="seat-legend vip">VIP - 8$</div>
        <div class="seat-legend selected">Selected</div>
        <div class="seat-legend taken">Taken</div>
    </div>

   
    <div class="seat-selector-container">
        <!-- Left Section -->
        <div class="hall-container left-section">
            <div class="screen">Screen</div>
            @for (char row = 'A'; row <= 'F'; row++)
            {
                <div class="hall-scheme-row">
                    @for (int seatNumber = 1; seatNumber <= 10; seatNumber++)
                    {
                        <div class="seat @GetVipClass(row)" data-row="@row" data-seat="@seatNumber">
                            @($"{row}{seatNumber}")
                        </div>
                        
                    }
                </div>
            }

            @for (char row = 'G'; row <= 'J'; row++)
            {
                <div class="hall-scheme-row">
                    @for (int seatNumber = 1; seatNumber <= 15; seatNumber++)
                    {
                        @* <div class="seat" data-row="@row" data-seat="@seatNumber">
                            @($"{row}{seatNumber}")
                        </div> *@
                        var seatId = $"{row}{seatNumber}";
                        <div class="seat @(seatId == "H8" ? "taken" : "")" data-row="@row" data-seat="@seatNumber">
                            @seatId
                        </div>
                    }
                </div>
            }
        </div>

        <!-- Right Section -->
        <div class="right-section">
            <div id="cancelSelectionFrame" class="cancel-selection-frame">Clear Selection</div>

            <div class="selected-seats">
                <p>Your selections</p>
            </div>

            <div class="total-section">
                <p>Total Seats: 0, VIP Seats: 0, Total Price: $0</p>
            </div>

            <div class="Reservation">
                <ul><a id="home-link" asp-area="" asp-controller="Reservation" asp-action="Reservations">Make a Reservation<span></span></a></ul>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        var seats = document.querySelectorAll(".seat");
        var cancelSelectionFrame = document.getElementById("cancelSelectionFrame");
        var selectedSeatsContainer = document.querySelector(".selected-seats");
        var totalSection = document.createElement("div"); 
        totalSection.classList.add("total-section"); 

        
        var selectionSummary = {
            totalSeats: 0,
            totalVipSeats: 0,
            totalPrice: 0
        };

        
        var totalSection = document.querySelector(".total-section");

        // First view of total
        totalSection.textContent = `Total Seats: ${selectionSummary.totalSeats}, VIP Seats: ${selectionSummary.totalVipSeats}, Total Price: $${selectionSummary.totalPrice.toFixed(2)}`;

        seats.forEach(function (seat) {
            seat.addEventListener("click", function () {
                seat.classList.toggle("selected");

                
                if (seat.classList.contains("selected")) {
                    selectionSummary.totalSeats++;
                    if (seat.classList.contains("vip")) {
                        selectionSummary.totalVipSeats++;
                        selectionSummary.totalPrice += 8; // VIP price
                    } else {
                        selectionSummary.totalPrice += 5; // Standard price
                    }
                } else {
                    selectionSummary.totalSeats--;
                    if (seat.classList.contains("vip")) {
                        selectionSummary.totalVipSeats--;
                        selectionSummary.totalPrice -= 8; // VIP price
                    } else {
                        selectionSummary.totalPrice -= 5; // Standard price
                    }
                }

                // Viewing total
                totalSection.textContent = `Total Seats: ${selectionSummary.totalSeats}, VIP Seats: ${selectionSummary.totalVipSeats}, Total Price: $${selectionSummary.totalPrice.toFixed(2)}`;

                
                if (seat.classList.contains("selected")) {
                    // Clonning 
                    var clonedSeat = seat.cloneNode(true);

                    // Adding a cloned class
                    if (seat.classList.contains("vip")) {
                        clonedSeat.classList.add("copied-vip");
                    } else {
                        clonedSeat.classList.add("copied");
                    }

                    
                    var priceSpan = document.createElement("span");
                    
                    selectedSeatsContainer.appendChild(clonedSeat);

                } else {
                    // Delete selcted seats from right section
                    var selectedSeat = selectedSeatsContainer.querySelector('[data-row="' + seat.dataset.row + '"][data-seat="' + seat.dataset.seat + '"]');
                    if (selectedSeat) {
                        selectedSeat.remove();
                    }
                }
            });
        });

        // Adding Total to right section
        document.querySelector(".right-section").appendChild(totalSection);

        // Clear functionality
        cancelSelectionFrame.addEventListener("click", function () {
            var selectedSeats = document.querySelectorAll(".selected");
            selectedSeats.forEach(function (selectedSeat) {
                // Check if not legend
                var isLegend = selectedSeat.closest('.hall-legend') !== null;

                if (!isLegend) {
                    selectedSeat.classList.remove("selected");
                }
            });

            // Delete selected
            var selectedSeats = selectedSeatsContainer.querySelectorAll('.copied, .copied-vip');
            selectedSeats.forEach(function (selectedSeat) {
                selectedSeat.remove();
            });


            // Reset
            selectionSummary = {
                totalSeats: 0,
                totalVipSeats: 0,
                totalPrice: 0
            };

            // Reste total section
            totalSection.textContent = "Total Seats: 0, VIP Seats: 0, Total Price: $0.00";
        });
    });

    @functions {
        string GetVipClass(char row)
        {
            if (row == 'E' || row == 'F')
            {
                return "vip";
            }
            return "";
        }
    }
</script>