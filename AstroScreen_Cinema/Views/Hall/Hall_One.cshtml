@namespace AstroScreen_Cinema.Views.NowShowing
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers

@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewData["Title"] = "Hall";
}

<link rel="stylesheet" href="~/css/Hall/Hall1.css" />
<link rel="stylesheet" href="~/css/Home/site.css" />

@model AstroScreen_Cinema.Models.EntitiesDto.HallDto
@{
    var seatsPerRow = Model.NumberOfSeats / Model.NumberOfRows;
}
<div class="SeatSelector">
    <div class="SelectorTitle"> </div>
        <h1>@Model.City</h1>
    
    <!--Hall legend-->
    <div class="hall-legend">
        <div class="seat-legend">Not Selected</div>
        @* <div class="seat-legend vip">VIP - 8$</div> *@
        <div class="seat-legend selected">Selected - 5$</div>
        <div class="seat-legend taken">Taken</div>
    </div>

    <form asp-action="MakeReservation" asp-controller="Reservation" method="post" class="login--form_main">
        <div class="seat-selector-container">
            <!-- Left Section -->
            <div class="hall-container left-section">
                <div class="screen">Screen</div>

                @for (int row = 0; row<Model.NumberOfRows; row++)
                {
                    <div class="hall-scheme-row">
                        @for (int seatNumber = 0; seatNumber < seatsPerRow; seatNumber++)
                            {
                                //class="seat @GetVipClass(i)"
                            @* <div class="seat" data-row="@row" data-seat="@seatNumber">
                                @($"{@row} {@seatNumber}")
                            </div> *@
                            <div class="seat" data-row="@Convert.ToChar('A' + row)" data-seat="@seatNumber">
                                @($"{Convert.ToChar('A' + row)}{seatNumber}")
                            </div>
                        }
                    </div>
                }

                @*@for (char row = 'A'; row <= 'F'; row++)
                {
                    <div class="hall-scheme-row">
                        @for (int seatNumber = 1; seatNumber <= 10; seatNumber++)
                        {
                            <div class="seat @GetVipClass(row)" data-row="@row" data-seat="@seatNumber">
                                @($"{row}{seatNumber}")
                            </div>

                        }
                    </div>
                }*@

                @*@for (char row = 'G'; row <= 'J'; row++)
                {
                    <div class="hall-scheme-row">
                        @for (int seatNumber = 1; seatNumber <= 15; seatNumber++)
                        {
                            <div class="seat" data-row="@row" data-seat="@seatNumber">
                        @($"{row}{seatNumber}")
                    </div> 
                            var seatId = $"{row}{seatNumber}";
                            <div class="seat @(seatId == "H8" ? "taken" : "")" data-row="@row"
                                 data-seat="@seatNumber" value="@seatId">
                                @seatId
                            </div>
                        }
                    </div>
                 }*@
            </div>
</form>

            <!-- Right Section -->
            <div class="right-section">
                <div id="cancelSelectionFrame" class="cancel-selection-frame">Clear Selection</div>

                <div class="selected-seats">
                    <p>Your selections</p>
                </div>

                <div class="total-section">
                    <p>Total Seats: 0, VIP Seats: 0, Total Price: $0</p>
                </div>

                <div class="Reservation">
                    <ul><a id="home-link" asp-area="" asp-controller="Reservation" asp-action="Reservations">Make a Reservation<span></span></a></ul>
                </div>
            </div>
        </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        var seats = document.querySelectorAll(".seat");
        var cancelSelectionFrame = document.getElementById("cancelSelectionFrame");
        var selectedSeatsContainer = document.querySelector(".selected-seats");
        var totalSection = document.querySelector(".total-section");

        var selectionSummary = {
            totalSeats: 0,
            totalVipSeats: 0,
            totalPrice: 0
        };

        // First view of total
        totalSection.textContent = `Total Seats: ${selectionSummary.totalSeats}, Total Price: $${selectionSummary.totalPrice.toFixed(2)}`;

        seats.forEach(function (seat) {
            seat.addEventListener("click", function () {
                seat.classList.toggle("selected");

                if (seat.classList.contains("selected")) {
                    selectionSummary.totalSeats++;
                    if (seat.classList.contains("vip")) {
                        selectionSummary.totalVipSeats++;
                        selectionSummary.totalPrice += 8; // VIP price
                    } else {
                        selectionSummary.totalPrice += 5; // Standard price
                    }
                } else {
                    selectionSummary.totalSeats--;
                    if (seat.classList.contains("vip")) {
                        selectionSummary.totalVipSeats--;
                        selectionSummary.totalPrice -= 8; // VIP price
                    } else {
                        selectionSummary.totalPrice -= 5; // Standard price
                    }
                }

                // Viewing total
                totalSection.textContent = `Total Seats: ${selectionSummary.totalSeats}, Total Price: $${selectionSummary.totalPrice.toFixed(2)}`;

                if (seat.classList.contains("selected")) {
                    // Cloning
                    var clonedSeat = seat.cloneNode(true);

                    // Adding a cloned class
                    if (seat.classList.contains("vip")) {
                        clonedSeat.classList.add("copied-vip");
                    } else {
                        clonedSeat.classList.add("copied");
                    }

                    clonedSeat.addEventListener("click", function () {
                        seat.classList.remove("selected");
                        clonedSeat.remove();
                        updateTotal();
                    });

                    // Adding cloned seat to the right section
                    selectedSeatsContainer.appendChild(clonedSeat);
                } else {
                    // Remove selected seats from the right section
                    var selectedSeat = selectedSeatsContainer.querySelector('[data-row="' + seat.dataset.row + '"][data-seat="' + seat.dataset.seat + '"]');
                    if (selectedSeat) {
                        selectedSeat.remove();
                    }
                }
            });
        });

        // Adding Total to right section
        document.querySelector(".right-section").appendChild(totalSection);

        // Clear functionality
        cancelSelectionFrame.addEventListener("click", function () {
            seats.forEach(function (selectedSeat) {
                if (selectedSeat.classList.contains("selected")) {
                    selectedSeat.classList.remove("selected");
                }
            });

            // Remove selected seats from the right section
            var selectedSeats = selectedSeatsContainer.querySelectorAll('.copied, .copied-vip');
            selectedSeats.forEach(function (selectedSeat) {
                selectedSeat.remove();
            });

            // Reset
            selectionSummary = {
                totalSeats: 0,
                totalVipSeats: 0,
                totalPrice: 0
            };

            // Reset total section
            totalSection.textContent = "Total Seats: 0, Total Price: $0.00";
        });

        // Function to update total
        function updateTotal() {
            selectionSummary.totalSeats = document.querySelectorAll('.selected').length;
            selectionSummary.totalVipSeats = document.querySelectorAll('.copied-vip').length;
            selectionSummary.totalPrice = selectionSummary.totalSeats * 5 + selectionSummary.totalVipSeats * 8;

            // Update total section
            totalSection.textContent = `Total Seats: ${selectionSummary.totalSeats}, Total Price: $${selectionSummary.totalPrice.toFixed(2)}`;
        }
    });
</script>